import axios from 'axios';
import { APP_CONFIG } from '../config/config';

// ุฅูุดุงุก instance ูู axios ููู API
const contentApi = axios.create({
  baseURL: APP_CONFIG.api.baseURL,
  timeout: APP_CONFIG.api.timeout,
  headers: {
    'Content-Type': 'application/json',
  }
});

// ุฅุถุงูุฉ interceptor ููู token
contentApi.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Content Management API
export const contentApiService = {
  // ุฌูุจ ุฌููุน ูุญุชููุงุช ุงููููุน
  getAllContent: async () => {
    try {
      const response = await contentApi.get('/api/content/all');
      return response.data;
    } catch (error) {
      console.error('Error fetching content:', error);
      // Fallback to mock data
      return getMockContent();
    }
  },

  // ุฌูุจ ูุญุชูู ูุณู ูุนูู
  getSectionContent: async (section) => {
    try {
      const response = await contentApi.get(`/api/content/${section}`);
      return response.data;
    } catch (error) {
      console.error(`Error fetching ${section} content:`, error);
      return getMockSectionContent(section);
    }
  },

  // ุญูุธ ูุญุชูู ูุณู ูุนูู
  saveSectionContent: async (section, data) => {
    try {
      const response = await contentApi.put(`/api/content/${section}`, data);
      return response.data;
    } catch (error) {
      console.error(`Error saving ${section} content:`, error);
      // Save to localStorage as fallback
      saveToLocalStorage(section, data);
      return { success: true, message: 'ุชู ุงูุญูุธ ูุญููุงู' };
    }
  },

  // ุญูุธ ุฌููุน ุงููุญุชููุงุช
  saveAllContent: async (content) => {
    try {
      const response = await contentApi.put('/api/content/all', content);
      return response.data;
    } catch (error) {
      console.error('Error saving all content:', error);
      // Save to localStorage as fallback
      saveAllToLocalStorage(content);
      return { success: true, message: 'ุชู ุงูุญูุธ ูุญููุงู' };
    }
  },

  // ุฑูุน ููู
  uploadFile: async (file, type = 'image') => {
    try {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('type', type);

      const response = await contentApi.post('/api/content/upload', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      return response.data;
    } catch (error) {
      console.error('Error uploading file:', error);
      // Return mock URL as fallback
      return { url: URL.createObjectURL(file), filename: file.name };
    }
  },

  // ุฌูุจ ุชุงุฑูุฎ ุงูุชุนุฏููุงุช
  getVersionHistory: async (section) => {
    try {
      const response = await contentApi.get(`/api/content/${section}/history`);
      return response.data;
    } catch (error) {
      console.error('Error fetching version history:', error);
      return getMockVersionHistory(section);
    }
  },

  // ุงุณุชุนุงุฏุฉ ูุณุฎุฉ ุณุงุจูุฉ
  restoreVersion: async (section, versionId) => {
    try {
      const response = await contentApi.post(`/api/content/${section}/restore/${versionId}`);
      return response.data;
    } catch (error) {
      console.error('Error restoring version:', error);
      return { success: false, message: 'ูุดู ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ' };
    }
  },

  // ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุชุตููู
  getThemeSettings: async () => {
    try {
      const response = await contentApi.get('/api/content/theme');
      return response.data;
    } catch (error) {
      console.error('Error fetching theme settings:', error);
      return getMockThemeSettings();
    }
  },

  // ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุชุตููู
  saveThemeSettings: async (theme) => {
    try {
      const response = await contentApi.put('/api/content/theme', theme);
      return response.data;
    } catch (error) {
      console.error('Error saving theme settings:', error);
      saveThemeToLocalStorage(theme);
      return { success: true, message: 'ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุชุตููู ูุญููุงู' };
    }
  },

  // ุฌูุจ ุฅุนุฏุงุฏุงุช SEO
  getSEOSettings: async () => {
    try {
      const response = await contentApi.get('/api/content/seo');
      return response.data;
    } catch (error) {
      console.error('Error fetching SEO settings:', error);
      return getMockSEOSettings();
    }
  },

  // ุญูุธ ุฅุนุฏุงุฏุงุช SEO
  saveSEOSettings: async (seo) => {
    try {
      const response = await contentApi.put('/api/content/seo', seo);
      return response.data;
    } catch (error) {
      console.error('Error saving SEO settings:', error);
      saveSEOToLocalStorage(seo);
      return { success: true, message: 'ุชู ุญูุธ ุฅุนุฏุงุฏุงุช SEO ูุญููุงู' };
    }
  },

  // ุฌูุจ ูุงุฆูุฉ ุงูุตูุญุงุช
  getPages: async () => {
    try {
      const response = await contentApi.get('/api/content/pages');
      return response.data;
    } catch (error) {
      console.error('Error fetching pages:', error);
      return getMockPages();
    }
  },

  // ุญูุธ ูุงุฆูุฉ ุงูุตูุญุงุช
  savePages: async (pages) => {
    try {
      const response = await contentApi.put('/api/content/pages', pages);
      return response.data;
    } catch (error) {
      console.error('Error saving pages:', error);
      savePagesToLocalStorage(pages);
      return { success: true, message: 'ุชู ุญูุธ ุงูุตูุญุงุช ูุญููุงู' };
    }
  }
};

// Mock Data Functions
const getMockContent = () => ({
  homepage: {
    hero: {
      title: 'PayPass - ุบุณูู ุงูุณูุงุฑุงุช ุงูุฐูู',
      subtitle: 'ุงุญุตู ุนูู ุบุณูู ุงุญุชุฑุงูู ูุณูุงุฑุชู ุจุฃุณุนุงุฑ ููุงูุณุฉ',
      buttonText: 'ุงุญุฌุฒ ุงูุขู',
      backgroundImage: '/hero-bg.jpg',
      active: true
    },
    features: [
      {
        id: 1,
        title: 'ุบุณูู ุณุฑูุน',
        description: 'ุบุณูู ุงุญุชุฑุงูู ูู ุฃูู ูู 30 ุฏูููุฉ',
        icon: 'โก',
        active: true,
        order: 1
      },
      {
        id: 2,
        title: 'ุฃุณุนุงุฑ ููุงูุณุฉ',
        description: 'ุฃูุถู ุงูุฃุณุนุงุฑ ูุน ุถูุงู ุงูุฌูุฏุฉ',
        icon: '๐ฐ',
        active: true,
        order: 2
      },
      {
        id: 3,
        title: 'ุฎุฏูุฉ 24/7',
        description: 'ุฎุฏูุฉ ูุชุงุญุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ',
        icon: '๐',
        active: true,
        order: 3
      }
    ],
    stats: [
      { id: 1, number: '1000+', label: 'ุนููู ุฑุงุถู', active: true, order: 1 },
      { id: 2, number: '50+', label: 'ูุฑุน', active: true, order: 2 },
      { id: 3, number: '24/7', label: 'ุฎุฏูุฉ ูุชุงุญุฉ', active: true, order: 3 },
      { id: 4, number: '5โญ', label: 'ุชูููู', active: true, order: 4 }
    ]
  },
  services: [
    {
      id: 1,
      title: 'ุงูุบุณูู ุงูุฃุณุงุณู',
      description: 'ุบุณูู ุฎุงุฑุฌู ุดุงูู ููุณูุงุฑุฉ',
      price: '25 ุฑูุงู',
      duration: '15 ุฏูููุฉ',
      features: ['ุบุณูู ุฎุงุฑุฌู', 'ุชุฌููู', 'ุชุนุทูุฑ'],
      image: '/service-basic.jpg',
      active: true,
      category: 'basic',
      order: 1
    },
    {
      id: 2,
      title: 'ุงูุบุณูู ุงูุดุงูู',
      description: 'ุบุณูู ุฏุงุฎูู ูุฎุงุฑุฌู ุดุงูู',
      price: '45 ุฑูุงู',
      duration: '30 ุฏูููุฉ',
      features: ['ุบุณูู ุฏุงุฎูู ูุฎุงุฑุฌู', 'ุชุฌููู', 'ุชุนุทูุฑ', 'ุชูููุน'],
      image: '/service-premium.jpg',
      active: true,
      category: 'premium',
      order: 2
    }
  ],
  packages: [
    {
      id: 1,
      title: 'ุงูุจุงูุฉ ุงูุดูุฑูุฉ',
      description: 'ุบุณูู ุบูุฑ ูุญุฏูุฏ ููุฏุฉ ุดูุฑ',
      price: '199 ุฑูุงู',
      originalPrice: '299 ุฑูุงู',
      features: ['ุบุณูู ุบูุฑ ูุญุฏูุฏ', 'ุฎุตู 30%', 'ุฎุฏูุฉ VIP'],
      image: '/package-monthly.jpg',
      active: true,
      duration: '30 ููู',
      order: 1
    }
  ],
  blog: [
    {
      id: 1,
      title: 'ูุตุงุฆุญ ููุญูุงุธ ุนูู ูุธุงูุฉ ุณูุงุฑุชู',
      excerpt: 'ุชุนุฑู ุนูู ุฃูุถู ุงูุทุฑู ููุญูุงุธ ุนูู ูุธุงูุฉ ุณูุงุฑุชู',
      content: 'ูุญุชูู ุงูููุงู ุงููุงูู...',
      author: 'ูุฑูู PayPass',
      date: '2024-01-15',
      image: '/blog-1.jpg',
      tags: ['ูุตุงุฆุญ', 'ุตูุงูุฉ'],
      active: true,
      views: 1250,
      likes: 89,
      order: 1
    }
  ],
  settings: {
    siteName: 'PayPass',
    siteDescription: 'ุบุณูู ุงูุณูุงุฑุงุช ุงูุฐูู',
    contactEmail: 'info@paypass.com',
    contactPhone: '+966 50 123 4567',
    socialMedia: {
      facebook: 'https://facebook.com/paypass',
      twitter: 'https://twitter.com/paypass',
      instagram: 'https://instagram.com/paypass'
    }
  }
});

const getMockSectionContent = (section) => {
  const content = getMockContent();
  return content[section] || {};
};

const getMockVersionHistory = (section) => [
  {
    id: 1,
    version: '1.0.0',
    timestamp: new Date().toISOString(),
    author: 'ุฃุญูุฏ ูุญูุฏ',
    changes: 'ุชุญุฏูุซ ุงููุญุชูู ุงูุฃุณุงุณู',
    data: getMockSectionContent(section)
  }
];

const getMockThemeSettings = () => ({
  primaryColor: '#4e54c8',
  secondaryColor: '#2b3a67',
  accentColor: '#ff6b6b',
  backgroundColor: '#ffffff',
  textColor: '#333333',
  fontFamily: 'Cairo, sans-serif',
  borderRadius: '8px',
  shadow: '0 2px 8px rgba(0,0,0,0.1)',
  animation: true,
  darkMode: false
});

const getMockSEOSettings = () => ({
  metaTitle: 'PayPass - ุบุณูู ุงูุณูุงุฑุงุช ุงูุฐูู',
  metaDescription: 'ุงุญุตู ุนูู ุบุณูู ุงุญุชุฑุงูู ูุณูุงุฑุชู ุจุฃุณุนุงุฑ ููุงูุณุฉ',
  keywords: 'ุบุณูู ุณูุงุฑุงุช, ุบุณูู ุงุญุชุฑุงูู, PayPass',
  ogTitle: 'PayPass - ุบุณูู ุงูุณูุงุฑุงุช ุงูุฐูู',
  ogDescription: 'ุงุญุตู ุนูู ุบุณูู ุงุญุชุฑุงูู ูุณูุงุฑุชู ุจุฃุณุนุงุฑ ููุงูุณุฉ',
  ogImage: '/og-image.jpg',
  twitterCard: 'summary_large_image',
  canonicalUrl: 'https://paypass.com'
});

const getMockPages = () => [
  {
    id: 1,
    title: 'ุงูุฑุฆูุณูุฉ',
    slug: '/',
    active: true,
    order: 1,
    showInMenu: true,
    showInFooter: true
  },
  {
    id: 2,
    title: 'ุงูุฎุฏูุงุช',
    slug: '/services',
    active: true,
    order: 2,
    showInMenu: true,
    showInFooter: true
  },
  {
    id: 3,
    title: 'ุงูุจุงูุงุช',
    slug: '/packages',
    active: true,
    order: 3,
    showInMenu: true,
    showInFooter: true
  },
  {
    id: 4,
    title: 'ูู ูุญู',
    slug: '/about-us',
    active: true,
    order: 4,
    showInMenu: true,
    showInFooter: true
  },
  {
    id: 5,
    title: 'ุงุชุตู ุจูุง',
    slug: '/contact-us',
    active: true,
    order: 5,
    showInMenu: true,
    showInFooter: true
  }
];

// Local Storage Functions
const saveToLocalStorage = (section, data) => {
  try {
    localStorage.setItem(`content_${section}`, JSON.stringify(data));
  } catch (error) {
    console.error('Error saving to localStorage:', error);
  }
};

const saveAllToLocalStorage = (content) => {
  try {
    localStorage.setItem('content_all', JSON.stringify(content));
  } catch (error) {
    console.error('Error saving all content to localStorage:', error);
  }
};

const saveThemeToLocalStorage = (theme) => {
  try {
    localStorage.setItem('theme_settings', JSON.stringify(theme));
  } catch (error) {
    console.error('Error saving theme to localStorage:', error);
  }
};

const saveSEOToLocalStorage = (seo) => {
  try {
    localStorage.setItem('seo_settings', JSON.stringify(seo));
  } catch (error) {
    console.error('Error saving SEO to localStorage:', error);
  }
};

const savePagesToLocalStorage = (pages) => {
  try {
    localStorage.setItem('pages_settings', JSON.stringify(pages));
  } catch (error) {
    console.error('Error saving pages to localStorage:', error);
  }
};

export default contentApiService; 